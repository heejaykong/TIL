# 모달 구현할 때 focus를 가둬야 하는 이유
**2022. 11. 23. (수) 기록**

리액트로 모달... 구현하다가 새삼 깨달은 것을 기록한다

### 요약
남의 서비스를 이용하기만 하던 시절에는 모달을 띄울 때 **모달 위에서만** 동작하는 이벤트들이 당연한 줄로만 알았다.

아아 결코 당연한 것이 아니었거늘

편리한 모달 뒤에는 **DOM focus를 가두는 로직을 구현한 개발자의 땀**이 서려있다.

### 배경 설명
무거운 패키지를 추가하는게 싫어서 최대한 가벼운 모달 라이브러리를 추가해서 사용해봤다.

내가 쓴 건 `styled-react-modal`이라는 패키지였는데, 안에 코드를 까보니 단순히 div 태그만 띄우는 가벼운 라이브러리 같아 보였다. 맘에 들었다. focus의 필요성을 알기 전까지는...

### 문제
문제는 모달 내 '예' '아니오' 버튼을 누를 때 TAB, ENTER 등등 키보드로도 누를 수 있도록 편리성을 좀 추가하고 싶을 때 발생했다.

![image](https://user-images.githubusercontent.com/18097984/203450915-31650161-7993-4f27-91dd-2e87cdc52187.png)

모달을 띄운 순간, TAB 키를 누르면 '네' 버튼에 focus가 되는 것이 나의 바람이었다.

그러나! 노란 화살표로 표시한 저 네모를 보면 알 수 있다시피, TAB 키를 눌렀을 때 focus가 된 것은 엉뚱한 배경 document의 focusable한 첫번째 요소였다.

ENTER 키를 누를 때 핸들링하고자 handler 메소드를 작성할 때도 마찬가지였다.

Modal 컴포넌트 내부에서 handler를 작성해도, ENTER키가 감지되는 공간은 Modal 컴포넌트 내부가 아닌 배경까지 포함한 전체 Home 컴포넌트였다.

### 원인
이유는 키보드로 하는 액션이 모달 내부에 가둬져(trapped)있지 않았기 때문이었다.

모달도 결국 조건에 따라 보여지다 숨겨질 뿐인, 전체 컴포넌트 내부에 일부로써 존재하는 컴포넌트이기 때문에

키보드 액션이 모달 컴포넌트가 아닌 전체 컴포넌트에 적용되는 게 어찌보면 당연하다.

따라서 우리가 원하는 접근성 좋은 모달처럼 동작하려면, 모달이 show 상태일 때 유저의 focus를 모달 내부에 가두는 로직이 구현되어 있어야 한다. 그래야 TAB 또는 SHIFT + TAB 키를 눌렀을 때 모달 내부에서만 focus가 돌아다닐 수 있다.

### 해결 방법
그래서 처음엔 직접 구현해보려 했다! 그치만 너무 짜치는 일이었다~! 할일이 너무 많은데 시간은 금이었다~^^ 따라서 가장 좋은 방법은 라이브러리를 교체하는 것이었다.

`styled-react-modal`을 버리고 `react-modal`로 갈아끼웠다. `react-modal`은 알아서 포커싱을 해주기 때문에 내가 직접 포커싱을 구현할 필요가 없었다~ 인기 많은 라이브러리는 이유가 있었음을 다시금 깨닫고 다시는 객기를 부리지 않기로 다짐한다.

### 결론
* 모달을 띄울 때 자동 포커싱은 그냥 되는 게 아니다. 직접 구현하거나 그게 구현된 라이브러리를 찾아서 써야 한다~
* 그래서 `react-modal` 썼다~
* 적합한 라이브러리 빨리 찾는 것도 실력이구나를 깨달았다~

끝.

### 참고
* [How to create an accessible React modal](https://medium.com/@seif_ghezala/how-to-create-an-accessible-react-modal-5b87e6a27503)
* [[npm] (처음에 사용하려다가 focus의 중요성을 깨닫게 한) styled-react-modal 라이브러리](https://www.npmjs.com/package/styled-react-modal)
* [[npm] (focus trap이 잘 구현된) react-modal 라이브러리](https://www.npmjs.com/package/react-modal#installation)
